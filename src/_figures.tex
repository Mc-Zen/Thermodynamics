% !TeX root = Theo_IV.tex

\usepackage{tikz}
%\usepackage{pgfplots}
%\pgfplotsset{compat=1.18}

\usetikzlibrary{
    arrows.meta,
    bending,
    positioning,
    decorations.markings,
    intersections,
    calc,
    decorations.pathreplacing,
    decorations.pathmorphing,
    patterns
}
%\tikzexternalize[prefix=figures/,shell escape=-enable-write18] % activate

\tikzset{
    % Colors
    object color/.style={blue!40!black!80!white},
    object style/.style={object color,thick},
    nice green/.style={green!50!black},
    nice orange/.style={red!60!yellow!70!black!90!white},
    nice dark blue/.style={blue!50!black},
    nice light blue/.style={blue!60!white!70!black},
    nice turquoise/.style={blue!50!green},
    polarisation color/.style={purple},
    charge color/.style={blue!50!white!70!black},
    red laser/.style={red!70!black},
    moving system color/.style={blue!60!black!70!white},
    %
    % Coordinate system
    coordsystem/.style={very thin, color=#1!50},
    xlabel/.style={anchor=north west},
    ylabel/.style={anchor=south east},
    %
    % Nodes and points
    invisible point/.style={circle,inner sep=0pt,outer sep=0pt,minimum size=0pt},
    point/.style={invisible point,fill=black,minimum size=4pt},
    %
    % Arrows
    arrow tip/.tip={Stealth},
    arr/.style={->,>={arrow tip}},
    rarr/.style={<-,>={arrow tip}},
    midarrow/.style={postaction=decorate,decoration={markings, mark=at position #1 with {\arrow[xshift=2.5pt]{arrow tip}}} },
    midarrow/.default=.5,
    rmidarrow/.style={postaction=decorate,decoration={markings, mark=at position #1 with {\arrowreversed{arrow tip}}} },
    rmidarrow/.default=.5,
    distance marker/.style={|<->|,>={arrow tip}},
}
\tikzstyle{every node}=[font=\footnotesize]


\newcommand{\tfigTitel}{
    \begin{tikzpicture}
        \pgfmathsetmacro{\shadowangle}{132}
        \newlength{\shadowdistance}
        \pgfmathsetlength{\shadowdistance}{0.1ex}
        \pgfmathsetmacro{\shadowopacity}{1}
        \pgfmathsetmacro{\shadowspread}{0.003}
        \pgfmathsetmacro{\shadowsize}{5}
        \pgfmathtruncatemacro{\totshadow}{100}
        \path[nice dark blue,opacity={\shadowopacity/\totshadow},shift={({132-180}:\shadowdistance)},scale={1+\shadowsize}] 
        foreach \nshadow [evaluate=\nshadow as \angshadow using \nshadow/\totshadow*360] in {1,...,\totshadow}{
            node[align=center] at (\angshadow:\shadowspread) {\huge Theoretische Physik 4\\ \\ \\
            \Large Thermodynamik/Statistische Physik}
            };
        \node[align=center] at (0,0) {\huge Theoretische Physik 4\\ \\ \\ \Large Thermodynamik/Statistische Physik};
    \end{tikzpicture}
}

% 100 particles in a rectangular box
\newcommand{\tfigSystemWithManyParticles}{
    \begin{tikzpicture}[scale=1.5]
        \draw (-1pt,-1pt) rectangle ($(3,2)+(1pt,1pt)$);
        \pgfmathsetseed{1}
        \foreach \i in {1,2,...,100}{
            \draw[fill=black] (rnd*3,rnd*2) circle[radius=.5pt];
        };
    \end{tikzpicture}
}

% Two chambers separated by a piston
\newcommand{\tfigTwoChambersSeparatedByPiston}{
    \begin{tikzpicture}[scale=1.6]
        \draw (0,0) rectangle (2,1);
        \node at (.5,.5) {1};
        \node at (1.5,.5) {2};
        \draw[pattern=north east lines] (.95,0) rectangle (1.05,1);
        \node at (0,-.5) {Wand} edge[arr,bend right=10] (.4,0);
        \node at (1.4,-.5) {Kolben} edge[arr,bend left=10] (1,0);
    \end{tikzpicture}
}

% Rectangular box with piston
\newcommand{\tfigRectangularBoxWithPiston}{
    \begin{tikzpicture}[scale=1.6]
        \draw[line width=3pt] (1,0) -- (1,1);
        \draw[line width=2pt] (1,.5) -- +(.8,0);
        \draw[draw=black!70!white,line width=3pt] (1.2,0) -- (0,0) -- (0,1) -- (1.2,1);
    \end{tikzpicture}
}

% Water with ice cubes. Stiring heats up the water and ice cubes vanish
\newcommand{\tfigWaterStiringIceCubes}{
    \begin{tikzpicture}[water color/.style={nice light blue},wave deco/.style={decoration={bumps,amplitude=-3,segment length=17}},scale=2]
        \begin{scope}
            \fill[blue!20!white!90!black] decorate[wave deco] {(0,.8) -- (1.2,.8)} -- (1.2,0) -- (0,0) -- (0,.8);
            \draw[thick] (0,0) rectangle (1.2,1); 
            \pgfmathsetseed{5}
            \foreach \i in {1,2,...,10} {
                \coordinate (A) at (rnd+.1,rnd*.5+.1);
                \fill[color=white,rotate around={rnd*360:(A)}] (A) rectangle +(2pt,2pt);
            };
            \node[water color] at (.6,.15) {$\mathrm{H}_2\mathrm{O}$};
            \node at (.6,1.2) {A};
        \end{scope}
        \draw[arr] (1.4,.5) -- +(.4,0); 
        \begin{scope}[xshift=2cm]
            \fill[blue!20!white!90!black] decorate[wave deco] {(0,.8) -- (1.2,.8)} -- (1.2,0) -- (0,0) -- (0,.8);
            \draw[thick] (0,0) rectangle (1.2,1); 
            \foreach \i in {1,2,...,4} {
                \coordinate (A) at (rnd+.1,rnd*.5+.1);
                \fill[color=white,rotate around={rnd*360:(A)}] (A) rectangle +(2pt,2pt);
            };
            \node[water color] at (.6,.15) {$\mathrm{H}_2\mathrm{O}$};
            
            \draw (.5,.3) rectangle +(.2,.3) (.55,.3) rectangle +(.1,.3);
            \draw[thick] (.6,.6)-- +(0,.6);
            \draw[arr] (.6,1.3) arc[x radius=.2, y radius=.12,start angle=-270, end angle=90];
        \end{scope}
        \draw[arr] (3.4,.5) -- +(.4,0); 
        \begin{scope}[xshift=4cm]
            \fill[blue!20!white!90!black] decorate[wave deco] {(0,.8) -- (1.2,.8)} -- (1.2,0) -- (0,0) -- (0,.8);
            \draw[thick] (0,0) rectangle (1.2,1);
            \node[water color] at (.6,.15) {$\mathrm{H}_2\mathrm{O}$};
            \node at (.6,1.2) {B};
        \end{scope}
    \end{tikzpicture}
}

% Visualize that W,Q are no state functions. Adding different ratios of W and Q to a system may lead to the same inner energy U. 
\newcommand{\tfigWQAreNoStateFunctions}{
    \begin{tikzpicture}[scale=1.7]
        \node[point,label={north east}:$U(B)$] (Point B) at (2.2,1.4) {};
        \node[point,label={south west}:$U(A)$] (Point A) at (0,0) {} 
        edge[arr,bend left=50] node[midway, anchor=south east] {$\Delta W_1,\Delta Q_1$} node[midway, anchor=north west] {1} (Point B)
        edge[arr,bend right=60] node[midway, anchor=north west] {$\Delta W_2,\Delta Q_2$} node[midway, anchor=south east] {2} (Point B);
    \end{tikzpicture}
}

% Sketch of fundamental relations between inner energy and entropy.
\newcommand{\tfigSchemaFundamentalbeziehung}{    
    \begin{tikzpicture}[scale=1.5]
        \draw[arr] (0,0) node[anchor=north] {$0$} -- (0,2) node[ylabel] {$U$};
        \draw[arr] (0,0) -- (3,0) node[xlabel] {$S$};
        \draw[nice light blue] (0,1) .. controls +(0:1.2) and +(-135:.7) .. (2.5,1.8);
        \begin{scope}[xshift=4.5cm]
            \draw[arr] (0,0) node[anchor=north] {$0$} -- (0,2) node[ylabel] {$S$};
            \draw[arr] (0,0) -- (3,0) node[xlabel] {$U$};
            \draw[nice light blue] (1,0) .. controls +(90:.8) and +(-165:.7) .. (2.8,1.8);
        \end{scope}
    \end{tikzpicture}
}

% System with two subsystems separated by an impermeable and fixed but thermally conductive wall. 
\newcommand{\tfigDoppelsystemUSfesteWaermeleitendeWand}{
    \begin{tikzpicture}[scale=1.6]
        \draw (0,0) rectangle (2,1);
        \node[align=center] at (.5,.5) {$U^{(1)}$\\$S^{(1)}$};
        \node[align=center] at (1.5,.5) {$U^{(2)}$\\$S^{(2)}$};
        \draw[pattern=north east lines] (.95,0) rectangle (1.05,1);
        \node at (1.4,-.5) {fest, undurchlässig, isolierend $\rightarrow$ wärmeleitend} edge[arr,bend left=10] (1,0);
    \end{tikzpicture}
}

% System with two subsystems separated by an impermeable but movable and thermally conductive wall. 
\newcommand{\tfigDoppelsystemUVNbeweglicheWaermeleitendeWand}{
    \begin{tikzpicture}[scale=1.6]
        \draw (0,0) rectangle (2,1);
        \node[align=center] at (.5,.5) {$U^{(1)}$\\$V^{(1)}$\\$\sm^{(1)}$};
        \node[align=center] at (1.5,.5) {$U^{(2)}$\\$V^{(2)}$\\$\sm^{(2)}$};
        \draw[pattern=north east lines] (.95,0) rectangle (1.05,1);
        \node at (1.4,-.5) {undurchlässig, fest $\rightarrow$ beweglich, isolierend $\rightarrow$ wärmeleitend} edge[arr,bend left=10] (1,0);
    \end{tikzpicture}
}

% Function U(S) with maximum. 
\newcommand{\tfigFunktionEntropieMaximum}{
    \begin{tikzpicture}[scale=1.5]
        \draw[arr] (0,0) -- (0,2) node[ylabel] {$S$};
        \draw[arr] (0,0) -- (4,0) node[xlabel] {$U^{(1)}$};
        
        \path let \n{thermisches GG}={2}, \n{x1}={3},\n{x2}={3.5},\n{y1}={-.3*(\n{x1}-\n{thermisches GG})^2+1.5},\n{y2}={-.3*(\n{x2}-\n{thermisches GG})^2+1.5} in        
        coordinate (P1) at (\n{x1},\n{y1})
        coordinate (P2) at (\n{x2},\n{y2});
        \node[point] at (P1) {};
        \node[point] at (P2) {};
        \draw let \n{thermisches GG}={2} in plot[domain=.2:3.8] (\x,{-.3*(\x-\n{thermisches GG})^2+1.5});
        \draw[dashed] let \n{thermisches GG}={2},\p1=(P1),\p2=(P2) in 
        (\n{thermisches GG},1.5) -- +(0,-1.5) node[below,align=center] {thermisches\\Gleichgewicht}
        (0,\y1) -- (P1) -- (\x1,0) (0,\y2) -- (P2) -- (\x2,0);
        \draw[decorate, decoration = {brace}] let \p1=(P1),\p2=(P2) in
        (0,\y2)  --(0,\y1) node[midway,left]{$\Delta S$};
        \draw[decorate, decoration = {brace}] let \p1=(P1),\p2=(P2) in
        (\x2,0)  --(\x1,0) node[midway,below]{$\Delta U^{(1)}$};
        
        \draw[arr] ([shift={(.1,.1)}]P2)to[bend right=3] ([shift={(.1,.1)}]P1);
    \end{tikzpicture}
}


% System with two subsystems separated by a fixed but semipermeable and thermally conductive wall. 
\newcommand{\tfigDoppelsystemUVNbeweglicheIsolierendeWand}{
    \begin{tikzpicture}[scale=1.6]
        \draw (0,0) rectangle (2,1);
        \node[align=center] at (.5,.5) {$U^{(1)}$\\$\sm_1^{(1)}$\\$S^{(1)}$};
        \node[align=center] at (1.5,.5) {$U^{(2)}$\\$\sm_1^{(2)}$\\$S^{(2)}$};
        \draw[pattern=north east lines] (.95,0) rectangle (1.05,1);
        \node at (1.4,-.5) {fest, materieundurchlässig $\rightarrow$ durchlässig für Molekülsorte 1, isolierend $\rightarrow$ wärmeleitend} edge[arr,bend left=10] (1,0);
    \end{tikzpicture}
}


% Degeneracy function g(n,N) for N >> 1 (gaussian approximation)
\newcommand{\tfigDegeneracyFunctionGauss}{
    \begin{tikzpicture}[scale=4]
        \draw[arr] (-.7,0) -- (.7,0) node[xlabel] {$\frac{n}{N}$};
        %\draw[arr] (0,0) -- (0,1) node[ylabel] {$g(n,N)$};
        
        \draw let \n{N}={10} in plot[domain=-.5:.5,smooth,yscale=.003] (\x,{sqrt(2/(3.14159*\n{N}))*2^\n{N}*exp(-2*(\x*\n{N})^2/\n{N})}) 
        coordinate (P) at ({sqrt(1/(2*\n{N}))},{.003*sqrt(2/(3.14159*\n{N}))*2^\n{N}/exp(1)});
        \draw (-.5,.02) -- +(0,-.04) node[below] {$-\frac{1}{2}$}(.5,.02) -- +(0,-.04) node[below] {$\frac{1}{2}$};
        \draw[dashed] let \p1=(P) in (-\x1,0) -- (-\x1,\y1) -- (\x1,\y1) -- (\x1,0); 
        
        \draw[decoration={brace},decorate] let \p1=(P) in (\x1,-.02) -- +(-\x1,0) node[midway, below,yshift=-.04cm] {$\frac{n_n}{N}$};
    \end{tikzpicture}
}


% (1) System with two subsystems and wall, one filled with particles
% (2) barrier opened
\newcommand{\tfigTwoSubsystemsParticlesRemoveWall}{
    \begin{tikzpicture}[scale=1.5]
        \draw (0,0) rectangle (2, 1.3);
        \node at (1,1.5) {(1)};
        \draw (1,0) -- (1,1.3);
        \pgfmathsetseed{2}
        \foreach \n in {1,...,30}{
            \fill (.02+rnd*0.96,.02+rnd*1.26) circle[radius=.5pt];
        }
        
        \draw[arr] (2.3,1.3*2/3) -- +(1.3,0) node[midway, above] {$S$ wächst};
        \draw[rarr] (2.3,1.3/3) -- +(1.3,0) node[midway, below] {?};
        
        \begin{scope}[xshift=3.9cm]
            \node at (1,1.5) {(2)};
            \draw (0,0) rectangle (2, 1.3);
            \pgfmathsetseed{3}
            \foreach \n in {1,...,30}{
                \fill (.02+rnd*1.96,.02+rnd*1.26) circle[radius=.5pt];
            }
        \end{scope}
    \end{tikzpicture}
}


% Degeneracy function for large systems -> delta function
\newcommand{\tfigDegeneracyFunctionLargeSystemsDelta}{
    \begin{tikzpicture}[scale=4]
        \draw[arr] (-.7,0) -- (.7,0) node[xlabel] {$\frac{n_1}{N_1}$};
        \draw[arr] (0,0) -- (0,.7) node[ylabel] {$(g_1g_2)(n_1)$};
        \draw (-.5,.5pt) -- +(0,-1pt) node[below] {$-\frac{1}{2}$};
        \draw (.5,.5pt) -- +(0,-1pt) node[below] {$\frac{1}{2}$};
        \draw[nice green] (.2,.5) -- (.2,0) node[near start, right] {$\frac{\delta_n}{N_1}=10^{-11}$}
        node[below,black] {$\frac{\hat{n}_1}{N_1}$};
        \draw (.5pt,.5) -- (-.5pt,.5) node[left] {$(g_1g_2)_\mathrm{max}$};
    \end{tikzpicture}
}